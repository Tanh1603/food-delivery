config:
  target: "{{ $processEnvironment.TARGET_URL }}"
  phases:
    - duration: 120
      arrivalRate: 50
      name: "Order flow test"

  processor: "./processor.js"

scenarios:
  - name: "Complete Order Flow"
    flow:
      # Browse restaurants
      - get:
          url: "/api/restaurants"
          capture:
            - json: "$[0].id"
              as: "restaurantId"

      - think: 2

      # Get menu
      - get:
          url: "/api/restaurants/{{ restaurantId }}/menu"
          capture:
            - json: "$[0].id"
              as: "menuItemId"

      - think: 5

      # Place order
      - post:
          url: "/api/orders"
          json:
            restaurant_id: "{{ restaurantId }}"
            user_email: "user{{ $randomNumber(1, 1000) }}@test.com"
            items:
              - menu_item_id: "{{ menuItemId }}"
                quantity: "{{ $randomNumber(1, 3) }}"
          capture:
            - json: "$.id"
              as: "orderId"
          expect:
            - statusCode: 201

      - think: 2

      # Check order status
      - get:
          url: "/api/orders/{{ orderId }}"
          expect:
            - statusCode: 200
